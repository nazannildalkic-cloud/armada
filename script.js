const translations = {
    de: {
        nav_home: "Home", nav_packages: "Konzepte", nav_gallery: "Galerie", nav_date: "Termin",
        hero_title: "Unvergessliche Momente.", hero_sub: "Exklusive SÃ¤le fÃ¼r Ihre Traumhochzeit & Firmenevents.",
        btn_date: "Termin buchen", about_title: "Willkommen bei Armada",
        about_text: "Erleben Sie Luxus in Perfektion. Ob Hochzeit, Abiball oder Firmenfeier â€“ unsere drei prachtvollen SÃ¤le bieten den perfekten Rahmen fÃ¼r 250 bis 700 GÃ¤ste in Hamburg.",
        pack_title: "Event Konzepte", p1_title: "Basis Konzept", p2_title: "Premium Paket", p3_title: "Royal All-In",
        form_title: "Termin vereinbaren", form_btn: "Anfrage Senden"
    },
    tr: {
        nav_home: "Ana Sayfa", nav_packages: "Konseptler", nav_gallery: "Galeri", nav_date: "Randevu",
        hero_title: "Unutulmaz Anlar.", hero_sub: "DÃ¼ÄŸÃ¼nler ve Davetler iÃ§in Ã¶zel salonlar.",
        btn_date: "Randevu Al", about_title: "Armada'ya HoÅŸ Geldiniz",
        about_text: "LÃ¼ksÃ¼ mÃ¼kemmellikle yaÅŸayÄ±n. 250'den 700 misafir kapasitesine kadar olan salonlarÄ±mÄ±zla hizmetinizdeyiz.",
        pack_title: "Etkinlik Konseptleri", p1_title: "Temel Paket", p2_title: "Premium Paket", p3_title: "Kraliyet Paketi",
        form_title: "Randevu AlÄ±n", form_btn: "GÃ¶nder"
    },
    ar: {
        nav_home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", nav_packages: "Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…", nav_gallery: "Ø§Ù„Ù…Ø¹Ø±Ø¶", nav_date: "Ù…ÙˆØ¹Ø¯",
        hero_title: "Ù„Ø­Ø¸Ø§Øª Ù„Ø§ ØªÙÙ†Ø³Ù‰", hero_sub: "Ù‚Ø§Ø¹Ø§Øª Ø­ØµØ±ÙŠØ© Ù„Ø­ÙÙ„Ø§Øª Ø§Ù„Ø²ÙØ§Ù ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
        btn_date: "Ø·Ù„Ø¨ Ù…ÙˆØ¹Ø¯", about_title: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø£Ø±Ù…Ø§Ø¯Ø§",
        pack_title: "Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª", p1_title: "Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", p2_title: "Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ù…Ù…ÙŠØ²", p3_title: "Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ù…Ù„ÙƒÙŠ",
        form_title: "Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ø§Ù‹", form_btn: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨"
    },
    en: {
        nav_home: "Home", nav_packages: "Concepts", nav_gallery: "Gallery", nav_date: "Inquiry",
        hero_title: "Unforgettable Moments.", hero_sub: "Exclusive venues for weddings & corporate events.",
        btn_date: "Book Now", about_title: "Welcome to Armada",
        pack_title: "Event Concepts", p1_title: "Basic Concept", p2_title: "Premium Package", p3_title: "Royal All-In",
        form_title: "Inquire Now", form_btn: "Send Inquiry"
    },
    fa: {
        nav_home: "Ø®Ø§Ù†Ù‡", nav_packages: "Ù…ÙØ§Ù‡ÛŒÙ…", nav_gallery: "Ú¯Ø§Ù„Ø±ÛŒ", nav_date: "Ù‚Ø±Ø§Ø± Ù…Ù„Ø§Ù‚Ø§Øª",
        hero_title: "Ù„Ø­Ø¸Ø§Øª ÙØ±Ø§Ù…ÙˆØ´ Ù†Ø´Ø¯Ù†ÛŒ", hero_sub: "ØªØ§Ù„Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ø¹Ø±ÙˆØ³ÛŒ Ø´Ù…Ø§",
        btn_date: "Ø±Ø²Ø±Ùˆ ÙˆÙ‚Øª", about_title: "Ø¨Ù‡ Ø¢Ø±Ù…Ø§Ø¯Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯",
        pack_title: "Ù…ÙØ§Ù‡ÛŒÙ… Ø±ÙˆÛŒØ¯Ø§Ø¯", p1_title: "Ù…ÙÙ‡ÙˆÙ… Ù¾Ø§ÛŒÙ‡", p2_title: "Ù…ÙÙ‡ÙˆÙ… Ù…Ù…ØªØ§Ø²", p3_title: "Ù…ÙÙ‡ÙˆÙ… Ø³Ù„Ø·Ù†ØªÛŒ",
        form_title: "Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆÙ‚Øª", form_btn: "Ø§Ø±Ø³Ø§Ù„"
    }
};

const PUBLIC_KEY = "946075e6-8ecc-45cb-9daf-7a22a29003e7";
const ASSISTANT_ID = "921ca283-bfda-457d-9cf6-261fc43d46fe";
let vapi = null;
let isCallActive = false;

// Ayla â€“ BegrÃ¼ÃŸung in der gewÃ¤hlten Seitensprache (wird beim Start gesprochen)
const AYLA_FIRST_MESSAGE = {
    de: "Willkommen beim Armada Eventsaal. Ich bin Ayla, Ihre Assistentin. Ich spreche Deutsch, TÃ¼rkisch, Arabisch, Farsi und Englisch. Womit kann ich Ihnen helfen?",
    tr: "Armada Eventsaal'a hoÅŸ geldiniz. Ben Ayla, asistanÄ±nÄ±zÄ±m. TÃ¼rkÃ§e, Almanca, ArapÃ§a, FarsÃ§a ve Ä°ngilizce konuÅŸuyorum. Size nasÄ±l yardÄ±mcÄ± olabilirim?",
    ar: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø£Ø±Ù…Ø§Ø¯Ø§ Ø¥ÙŠÙÙ†ØªØ³Ø¢Ù„. Ø£Ù†Ø§ Ø£ÙŠÙ„Ø§ØŒ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒÙ…. Ø£ØªØ­Ø¯Ø« Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© ÙˆØ§Ù„ØªØ±ÙƒÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„ÙØ§Ø±Ø³ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ",
    en: "Welcome to Armada Eventsaal. I'm Ayla, your assistant. I speak German, Turkish, Arabic, Farsi and English. How can I help you?",
    fa: "Ø¨Ù‡ Ø³Ø§Ù„Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¢Ø±Ù…Ø§Ø¯Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù…Ù† Ø§ÛŒÙ„Ø§ØŒ Ø¯Ø³ØªÛŒØ§Ø± Ø´Ù…Ø§ Ù‡Ø³ØªÙ…. Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†ÛŒØŒ ØªØ±Ú©ÛŒØŒ Ø¹Ø±Ø¨ÛŒØŒ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ù…. Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ú©Ù…Ú© Ú©Ù†Ù…ØŸ"
};

var AYLA_SYSTEM_PROMPT = [
    "You are Ayla, the female voice assistant of Armada Eventsaal Hamburg. You have a female voice and speak naturally in the guest's language.",
    "You speak and answer in: German, Turkish, Arabic, Farsi, and English. Always reply in the same language the guest uses. Never say 'I can only speak...' or apologize for languages. Just answer.",
    "Answer every question fully: Address (GrÃ¼ndgensstrasse 26, 22309 Hamburg), capacity (250â€“700 guests), events (weddings, proms, corporate events), contact (WhatsApp +49 120 711 7110, info@armada-events.de), owner (Irfan GÃ¼ndoÄŸan), services (catering, lighting, decoration, full service), packages (Basis, Premium, Royal All-In). Do not give prices; say to contact the owner for a quote.",
    "Be friendly, concise, and professional. If someone wants to book, ask for name and phone number."
].join(" ");

function updateAylaStatus(text, isError) {
    var status = document.getElementById('status-text');
    if (!status) return;
    status.innerText = text;
    status.style.color = isError ? "#FF5252" : "";
}

function initVapi() {
    if (typeof window.Vapi === 'undefined') {
        updateAylaStatus("Ayla nicht geladen", true);
        return;
    }
    if (vapi) return;
    vapi = new window.Vapi(PUBLIC_KEY);
    var btn = document.getElementById('vapi-btn');
    var status = document.getElementById('status-text');
    vapi.on('call-start', function () {
        isCallActive = true;
        if (btn) btn.classList.add('listening');
        if (status) status.innerText = "Ayla hÃ¶rt zu...";
    });
    vapi.on('call-end', function () {
        isCallActive = false;
        if (btn) btn.classList.remove('listening');
        if (status) status.innerText = "Frag Ayla";
    });
    vapi.on('error', function (err) {
        updateAylaStatus("Ayla nicht verbunden", true);
        console.error(err);
    });
}

window.startVoiceAgent = async function () {
    if (typeof window.Vapi === 'undefined') {
        updateAylaStatus("Ayla nicht geladen", true);
        return;
    }
    if (!vapi) initVapi();
    if (!vapi) return;
    if (isCallActive) {
        vapi.stop();
        return;
    }
    updateAylaStatus("Verbinde Ayla...", false);
    var lang = (document.querySelector('.lang-btn.active') && document.querySelector('.lang-btn.active').innerText) || 'DE';
    var langKey = lang.toLowerCase();
    var firstMsg = AYLA_FIRST_MESSAGE[langKey] || AYLA_FIRST_MESSAGE.de;
    var overrides = {
        voice: {
            provider: "11labs",
            voiceId: "21m00Tcm4TlvDq8ikWAM"
        },
        firstMessage: firstMsg,
        model: {
            messages: [{ role: "system", content: AYLA_SYSTEM_PROMPT }]
        }
    };
    try {
        await vapi.start(ASSISTANT_ID, overrides);
    } catch (err) {
        try {
            await vapi.start(ASSISTANT_ID);
        } catch (e) {
            updateAylaStatus("Ayla nicht verbunden", true);
            console.error(e);
        }
    }
};

// --- WHATSAPP CONFIG (CALLMEBOT) ---
const WA_PHONE = "491207117110"; // WhatsApp-Nummer: +49 1207117110 (international ohne +/00)
const WA_API_KEY = "HIER_DER_WHATSAPP_CODE"; // Den Code von callmebot.com (fÃ¼r Formular-Benachrichtigungen)

window.handleBooking = async function (e) {
    e.preventDefault();
    const name = document.getElementById('form-name').value;
    const phone = document.getElementById('form-phone').value;
    const status = document.getElementById('form-status');
    const lang = document.querySelector('.lang-btn.active')?.innerText || 'DE';

    status.style.display = 'block';
    status.style.color = 'var(--gold)';
    status.innerText = "Sende Anfrage...";

    const message = `ğŸ”” *NEUE ANFRAGE (ARMADA)*%0A%0AğŸ‘¤ *Name:* ${name}%0AğŸ“ *Telefon:* ${phone}%0AğŸŒ *Sprache:* ${lang}%0A%0AğŸ‘‰ *Bitte umgehend kontaktieren!*`;

    try {
        const url = `https://api.callmebot.com/whatsapp.php?phone=${WA_PHONE}&text=${message}&apikey=${WA_API_KEY}`;

        // Wir nutzen 'no-cors', da CallMeBot eine einfache URL-Abfrage ist
        await fetch(url, { mode: 'no-cors' });

        status.style.color = "#4CAF50";
        status.innerText = "Erfolgreich gesendet! Wir melden uns.";
        e.target.reset();
    } catch (error) {
        status.style.color = "#FF5252";
        status.innerText = "Fehler beim Senden. Bitte erneut versuchen.";
    }
};

window.switchLang = function (lang) {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) el.innerHTML = translations[lang][key];
    });
    document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.getAttribute('onclick').includes(lang)));
    document.body.style.direction = (lang === 'ar' || lang === 'fa') ? 'rtl' : 'ltr';
};

function runSlideshow() {
    const slides = document.querySelectorAll('.slide');
    if (!slides.length) return;
    let current = 0;
    slides.forEach((s, i) => { if (s.classList.contains('active')) current = i; });
    slides[current].classList.remove('active');
    slides[(current + 1) % slides.length].classList.add('active');
}

function initAnimations() {
    const obs = new IntersectionObserver((es) => {
        es.forEach(e => { if (e.isIntersecting) { e.target.classList.add('aos-animate'); } });
    }, { threshold: 0.1 });
    document.querySelectorAll('[data-aos]').forEach(el => obs.observe(el));
}

function whenVapiReady(fn) {
    var done = false;
    function run() {
        if (done || typeof window.Vapi === 'undefined') return;
        done = true;
        fn();
    }
    if (typeof window.Vapi !== 'undefined') { run(); return; }
    window.addEventListener('vapi-ready', run, { once: true });
    var t = setInterval(function () {
        if (typeof window.Vapi !== 'undefined') run();
        if (done) clearInterval(t);
    }, 200);
    setTimeout(function () { clearInterval(t); }, 15000);
}

document.addEventListener('DOMContentLoaded', () => {
    whenVapiReady(initVapi);
    initAnimations();
    setInterval(runSlideshow, 5000);
});

window.openModal = function (type) {
    let title = "";
    let content = "";

    if (type === 'impressum') {
        title = "Impressum";
        content = `
            <p><strong>Betreiber:</strong><br>Irfan GÃ¼ndoÄŸan<br>GrÃ¼ndgensstrasse 26<br>22309 Hamburg</p>
            <p><strong>Kontakt:</strong><br>Mobil: 0176 â€“ 100 19 618<br>E-Mail: info@armada-events.de</p>
            <p><strong>Verantwortlich fÃ¼r den Inhalt:</strong><br>Irfan GÃ¼ndoÄŸan</p>
        `;
    } else if (type === 'datenschutz') {
        title = "Datenschutz";
        content = `
            <p>Wir nehmen den Schutz Ihrer persÃ¶nlichen Daten sehr ernst. Die Ã¼ber das Kontaktformular gesendeten Daten werden ausschlieÃŸlich zur Bearbeitung Ihrer Anfrage verwendet und per verschlÃ¼sselter Schnittstelle (Telegram API) an unsere Mitarbeiter weitergeleitet.</p>
            <p>Sie haben jederzeit das Recht auf Auskunft, Berichtigung oder LÃ¶schung Ihrer Daten.</p>
        `;
    } else if (type === 'kuendigung') {
        title = "KÃ¼ndigungsvereinbarung";
        content = `
            <p><strong>1. Vertragspartner & Geltungsbereich</strong><br>Diese KÃ¼ndigungsvereinbarung gilt fÃ¼r alle Buchungen und VertrÃ¤ge zwischen dem Kunden und dem Armada Eventsaal (Irfan GÃ¼ndoÄŸan, GrÃ¼ndgensstrasse 26, 22309 Hamburg) fÃ¼r Saalmieten und Eventleistungen.</p>
            <p><strong>2. KÃ¼ndigung durch den Kunden</strong><br>Die KÃ¼ndigung des Vertrages hat schriftlich (z.â€¯B. per E-Mail an info@armada-events.de) zu erfolgen. Bei Stornierung gelten folgende Fristen und StornogebÃ¼hren (jeweils bezogen auf den gebuchten Eventtermin): mehr als 6 Monate vorher: keine StornogebÃ¼hr; 3â€“6 Monate vorher: 30â€¯% des vereinbarten Entgelts; 1â€“3 Monate vorher: 50â€¯%; weniger als 1 Monat vorher: 80â€¯%; bei Absage weniger als 14 Tage vorher: 100â€¯%. Abweichende Vereinbarungen im Einzelvertrag bleiben vorbehalten.</p>
            <p><strong>3. KÃ¼ndigung durch den Betreiber</strong><br>Der Betreiber kann den Vertrag aus wichtigem Grund auÃŸerordentlich kÃ¼ndigen (z.â€¯B. bei Zahlungsverzug, grobem VertragsverstoÃŸ oder hÃ¶herer Gewalt). Bereits geleistete Zahlungen werden in solchen FÃ¤llen anteilig erstattet, soweit gesetzlich erforderlich.</p>
            <p><strong>4. HÃ¶here Gewalt</strong><br>Bei hÃ¶herer Gewalt (z.â€¯B. behÃ¶rdliche SchlieÃŸung, Naturkatastrophen) sind beide Parteien von der Leistungspflicht befreit; bereits gezahlte BetrÃ¤ge werden im gegenseitigen Einvernehmen angerechnet oder erstattet.</p>
            <p><strong>5. Salvatorische Klausel</strong><br>Die Unwirksamkeit einzelner Klauseln berÃ¼hrt die GÃ¼ltigkeit der Ã¼brigen Bestimmungen nicht.</p>
            <p><em>Stand: Angabe nach Ihrer PrÃ¼fung. Bei Fragen wenden Sie sich bitte an den Inhaber.</em></p>
        `;
    }

    document.getElementById('legal-text').innerHTML = `<h3>${title}</h3>${content}`;
    document.getElementById('legal-modal').style.display = 'flex';
};
window.closeModal = function () { document.getElementById('legal-modal').style.display = 'none'; };
